<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LitMatch</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .content-container {
            width: 60%;
            margin: 50px auto;
            padding: 20px;
            background-color: #ffffff;
        }
        textarea {
            height: 150px;
        }
        .output-field {
            height: 300px;
            overflow-y: scroll;
            border: 1px solid #ced4da;
            border-radius: 5px;
            padding: 10px;
            background-color: #fff;
        }
        .citations-field {
            height: 150px;
            overflow-y: scroll;
            border: 1px solid #ced4da;
            border-radius: 5px;
            padding: 10px;
            background-color: #fff;
        }
        .slider-container {
            display: flex;
            align-items: center;
            margin-top: 20px;
        }
        .slider-container label {
            flex: 1;
        }
        .slider-container input[type="range"] {
            flex: 3;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            background: #e9ecef;
            outline: none;
            border-radius: 5px;
            cursor: pointer;
        }
        .slider-container input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #B31B1B;
            border-radius: 50%;
            cursor: pointer;
        }
        .slider-container input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #B31B1B;
            border-radius: 50%;
            cursor: pointer;
        }
        .slider-value {
            display: inline-block;
            margin-left: 10px;
            padding: 5px 10px;
            background-color: #B31B1B;
            color: white;
            font-weight: bold;
            border-radius: 5px;
        }
        .btn-primary {
        background-color: #B31B1B;
        border-color: #B31B1B;
        }
        .btn-primary:hover {
            background-color: #8e1616;
            border-color: #8e1616;
        }
        .btn-primary:disabled {
            background-color: #d06060; /* Muted red for disabled state */
            border-color: #d06060;
            cursor: not-allowed;
        }
        .navbar {
            background-color: #B31B1B;
        }
        .navbar-brand {
            color: white !important;
        }
        .info-text {
            color: gray;
            font-size: 0.9rem;
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-light">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">LitMatch</span>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="content-container shadow rounded">
        <h2 class="text-center mb-4" style="color: #B31B1B;">Find Related Works</h2>

        <!-- Abstract Input -->
        <div class="mb-4">
            <label for="abstractInput" class="form-label">Enter Your Abstract</label>
            <textarea id="abstractInput" class="form-control" placeholder="Paste your abstract here..."></textarea>
        </div>

        <!-- Sliders -->
        <div>
            <div class="slider-container">
                <label for="slider1" class="form-label">Breadth</label>
                <input type="range" class="form-range" id="slider1" min="5" max="20" step="1" value="10">
                <span id="slider1Value" class="slider-value">10</span>
            </div>
            <div class="slider-container">
                <label for="slider2" class="form-label">Depth</label>
                <input type="range" class="form-range" id="slider2" min="1" max="5" step="1" value="2">
                <span id="slider2Value" class="slider-value">2</span>
            </div>
            <div class="slider-container">
                <label for="slider3" class="form-label">Diversity</label>
                <input type="range" class="form-range" id="slider3" min="0" max="1" step="0.1" value="0">
                <span id="slider3Value" class="slider-value">0</span>
            </div>
        </div>

        <!-- Generate Button -->
        <div class="text-center mt-4 mb-4">
            <button id="generateButton" class="btn btn-primary btn-lg w-100">Generate</button>
            <p class="info-text">
                We will search through the entire arXiv corpus and find related works based on your provided abstract.
            </p>
        </div>

        <!-- Related Works Output -->
        <div class="mb-4" id="relatedWorksSection" style="display: none;">
            <label for="relatedWorksOutput" class="form-label">Generated Related Works Section</label>
            <div id="relatedWorksOutput" class="output-field">
                <!-- Related works content will be injected here -->
            </div>
        </div>

        <!-- Citations Output -->
        <div id="citationsSection" style="display: none;">
            <label for="citationsOutput" class="form-label">Citations</label>
            <div id="citationsOutput" class="citations-field">
                <!-- Citations content will be injected here -->
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <!-- JavaScript for handling the sliders and request -->
    <script>
        // Update slider values live
        document.getElementById('slider1').addEventListener('input', (e) => {
            document.getElementById('slider1Value').textContent = e.target.value;
        });
        document.getElementById('slider2').addEventListener('input', (e) => {
            document.getElementById('slider2Value').textContent = e.target.value;
        });
        document.getElementById('slider3').addEventListener('input', (e) => {
            document.getElementById('slider3Value').textContent = e.target.value;
        });

        // Handle the Generate button click
        document.getElementById('generateButton').addEventListener('click', async () => {
            // Disable the button
            const button = document.getElementById('generateButton');
            button.disabled = true;

            // Collect input data
            const abstract = document.getElementById('abstractInput').value;
            const breadth = document.getElementById('slider1').value;
            const depth = document.getElementById('slider2').value;
            const diversity = document.getElementById('slider3').value;

            // Prepare JSON data
            const requestData = {
                abstract: abstract,
                breadth: parseInt(breadth),
                depth: parseInt(depth),
                diversity: parseInt(diversity)
            };

            try {
                // Send POST request to /generate
                const response = await fetch('/generate', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(requestData),
                });

                // Handle response
                const result = await response.json();

                // Show and populate outputs
                document.getElementById('relatedWorksSection').style.display = 'block';
                document.getElementById('citationsSection').style.display = 'block';

                document.getElementById('relatedWorksOutput').innerText = result['related_works'] || 'No related works found.';
                document.getElementById('citationsOutput').innerText = result.citations?.join('\n') || 'No citations found.';
            } catch (error) {
                console.error('Error:', error);
                document.getElementById('relatedWorksOutput').innerText = 'Error fetching related works.';
                document.getElementById('citationsOutput').innerText = 'Error fetching citations.';
            }
        });
    </script>
</body>
</html>